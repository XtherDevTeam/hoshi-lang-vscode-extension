{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Hoshi",
  "scopeName": "source.hoshi",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#macros" },
    { "include": "#keywords" },
    { "include": "#entities" },
    { "include": "#constants" },
    { "include": "#punctuation" },
    { "include": "#operators" },
    { "include": "#variables" }
  ],
  "repository": {
    "macros": {
      "patterns": [
        {
          "name": "comment.block.macro.hoshi",
          "begin": "\\[\\[",
          "end": "\\]\\]",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.annotation.begin.hoshi" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.annotation.end.hoshi" }
          },
          "patterns": [
            { "include": "#strings" },
            { "include": "#constants" },
            {
              "name": "keyword.operator.comparison.hoshi",
              "match": "==|!=|<=|>=|<|>"
            },
            {
              "name": "entity.name.tag.hoshi",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            }
          ]
        }
      ]
    },
    "comments": {
      "patterns": [
        { "name": "comment.line.double-slash.hoshi", "match": "//.*" },
        { "name": "comment.block.hoshi", "begin": "/\\*", "end": "\\*/" }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.hoshi",
          "match": "\\b(func|interface|struct|impl|let|in|for|forEach|while|if|elif|else|return|continue|break|cast|constructor|import|export|as|from|try|catch|finally|throw|type_id|dyn_cast|noffi|always_inline|new|interfaceof|static|operator|callable|alias|finalizer|enum|datastruct)\\b"
        }
      ]
    },
    "strings": {
      "patterns": [
        { "name": "string.quoted.double.hoshi", "begin": "\"", "end": "\"", "patterns": [{ "name": "constant.character.escape.hoshi", "match": "\\\\." }] },
        { "name": "string.quoted.single.hoshi", "begin": "'", "end": "'", "patterns": [{ "name": "constant.character.escape.hoshi", "match": "\\\\." }] }
      ]
    },
    "constants": {
      "patterns": [
        { "name": "constant.language.hoshi", "match": "\\b(true|false|null)\\b" },
        { "name": "constant.numeric.decimal.hoshi", "match": "\\b[0-9]+\\.[0-9]+\\b" },
        { "name": "constant.numeric.integer.hoshi", "match": "\\b(0b[01]+|0o[0-7]+|0x[0-9a-fA-F]+|[0-9]+(u|U|l|L)?)\\b" },
        { "name": "constant.elipsis.hoshi", "match": "\\.\\.\\." }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.assignment.hoshi",
          "match": ":=|\\+=|-=|\\*=|/=|%=|&=|\\|=|\\^=|="
        },
        {
          "name": "keyword.operator.logical.hoshi",
          "match": "&&|\\|\\||!"
        },
        {
          "name": "keyword.operator.abstract.hoshi",
          "match": "interfaceof|impl"
        },
        {
          "name": "keyword.operator.comparison.hoshi",
          "match": "==|!=|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.arithmetic.hoshi",
          "match": "\\+\\+|--|\\+|-|\\*|/|%"
        },
        {
          "name": "keyword.operator.bitwise.hoshi",
          "match": "&|\\||\\^|~|<<|>>"
        }
      ]
    },
    "punctuation": {
        "patterns": [
            {
                "name": "punctuation.terminator.statement.hoshi",
                "match": ";"
            },
            {
                "name": "punctuation.separator.namespace.hoshi",
                "match": ":"
            },
            {
                "name": "punctuation.separator.comma.hoshi",
                "match": ","
            },
            {
                "name": "punctuation.accessor.hoshi",
                "match": "\\."
            },
            {
                "name": "punctuation.section.block.begin.hoshi",
                "match": "\\{"
            },
            {
                "name": "punctuation.section.block.end.hoshi",
                "match": "\\}"
            },
            {
                "name": "punctuation.section.parens.begin.hoshi",
                "match": "\\("
            },
            {
                "name": "punctuation.section.parens.end.hoshi",
                "match": "\\)"
            },
            {
                "name": "punctuation.section.brackets.begin.hoshi",
                "match": "\\["
            },
            {
                "name": "punctuation.section.brackets.end.hoshi",
                "match": "\\]"
            }
        ]
    },
    "entities": {
      "patterns": [
        {
          "name": "meta.use.hoshi",
          "match": "\\b(use)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.control.hoshi" },
            "2": { "name": "entity.name.type.hoshi" }
          }
        },
        {
          "name": "meta.alias.hoshi",
          "match": "\\b(alias)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*(=)\\s*([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.control.hoshi" },
            "2": { "name": "entity.name.type.hoshi" },
            "3": { "name": "keyword.operator.assignment.hoshi" },
            "4": { "name": "entity.name.type.hoshi" }
          }
        },
        {
          "name": "entity.name.function.hoshi",
          "match": "(?<=(func|constructor)\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.invocation.hoshi",
          "match": "[a-zA-Z_][a-zA-Z0-9_]*(?=\\()"
        },
        {
          "name": "entity.name.type.struct.hoshi",
          "match": "(?<=struct\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.type.interface.hoshi",
          "match": "(?<=interface\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.type.ellipsis.hoshi",
          "match": "(?<=\\.\\.\\.+)(\\s*)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "comment": "Restricted Template matching to avoid conflict with Less Than operator",
          "name": "meta.type.parameters.hoshi",
          "begin": "(?<=[a-zA-Z0-9_])<(?![=<])",
          "end": ">",
          "patterns": [
              { "include": "#keywords" }, 
              { "include": "#variables" }, 
              { "include": "#punctuation" }
          ]
        },
        {
          "name": "entity.name.type.hoshi",
          "match": "(?<=:\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.type.impl.hoshi",
          "match": "(?<=(impl|interfaceof)\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.type.enum.hoshi",
          "match": "(?<=(enum)\\s+)[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.dynamic.array.initializer.hoshi",
          "match": "(?<=new\\s+)[a-zA-Z_][a-zA-Z0-9_\\.]*(?=\\s*\\[)"
        }
      ]
    },
    "variables": {
      "patterns": [
        { "name": "variable.language.this.hoshi", "match": "\\bthis\\b" },
        { "name": "variable.other.hoshi", "match": "[a-zA-Z_][a-zA-Z0-9_]*" }
      ]
    }
  }
}